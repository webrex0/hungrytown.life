<!DOCTYPE html>
<html lang="my">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/fancybox.min.css">
    <link rel="stylesheet" href="css/flag-icon.css">
    <title>Malaysian Identity Number Numerology 马来西亚身份证易经数</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="container">
        <!-- Language Selector Dropdown -->
        <div class="language-dropdown-container">
            <button class="language-dropdown-button">
                <span class="flag-icon flag-icon-mys"></span> Malaysia ID
            </button>
            <div class="language-dropdown-list">
                <a href="index.html" onclick="changeLanguage('my')"><span class="flag-icon flag-icon-mys"></span> Malaysia
                    ID</a>
                <a href="ichingCN.html" onclick="changeLanguage('zh')"><span class="flag-icon flag-icon-chn"></span> China
                    ID</a>
            </div>
        </div>
    </div>

    <div class="container">
        <h3 class="text-center">Malaysian Identity Number Numerology <br>马来西亚身份证易经数</h3>

        <form id="icForm">
            <div class="form-group">
                <label for="icNumber">Enter Malaysian Identity Number (880213045257):</label>
                <input type="text" id="icNumber" name="icNumber" class="form-control" pattern="\d{12}" required>
            </div>
            <button type="submit" class="btn btn-primary">Format</button>
            <div class="find-button">
                <button type="button" class="btn btn-click" id="findNumberBtn" data-fancybox
                    data-src="#lookupModal">Find No.</button>
            </div>
        </form>

        <div style="display: none;" id="lookupModal">
            <h2>Lookup Number</h2>
            <input type="text" id="lookupNumberInput" placeholder="Enter a number">
            <button type="button" class="btn btn-primary" id="lookupBtn">Lookup</button>
            <div id="lookupResult"></div>
        </div>

        <!-- Formatted IC Table -->
        <div class="table-responsive">
            <table id="formattedIC" class="table hidden">
                <thead>
                    <tr>
                        <th>Y</th>
                        <th class="separator">Y</th>
                        <th>M</th>
                        <th class="separator">M</th>
                        <th>D</th>
                        <th class="separator">D</th>
                        <th>R</th>
                        <th class="separator">R</th>
                        <th>N</th>
                        <th class="separator">N</th>
                        <th>N</th>
                        <th>N</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="formattedRow">
                        <!-- Data will be inserted here -->
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Take Note Table -->
        <div class="table-responsive pb-5">
            <table id="takeNoteTable" class="table hidden">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Take Note 注意</th>
                    </tr>
                </thead>
                <tbody id="takeNoteRows">
                    <!-- Matched notes will be inserted here -->
                </tbody>
            </table>
        </div>

        <!-- Special Number Table -->
        <div class="table-responsive">
            <table id="specialNumberTable" class="table hidden">
                <thead>
                    <tr>
                        <th>Life Numbers 生命数字</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="specialNumberRow">
                        <!-- Special numbers will be inserted here -->
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Consecutive Number Table -->
        <div class="table-responsive">
            <table id="consecutiveNumberTable" class="table hidden">
                <thead>
                    <tr>
                        <th>Numbers</th>
                        <th>Analysis</th>
                    </tr>
                </thead>
                <tbody id="consecutiveNumberRows">
                    <!-- Consecutive number results will be inserted here -->
                </tbody>
            </table>
        </div>

        <!-- Age Table -->
        <div class="table-responsive">
            <table id="ageTable" class="table hidden">
                <thead>
                    <tr>
                        <th>Current Year 今年</th>
                        <th>Year of Birth 生日</th>
                        <th>Age 年龄</th>
                    </tr>
                </thead>
                <tbody>
                    <tr id="ageRow">
                        <!-- Age data will be inserted here -->
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Category Table -->
        <div class="table-responsive">
            <table id="categoryTable" class="table hidden">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="categoryRows">
                    <!-- Category values will be inserted here -->
                </tbody>
            </table>
            <table id="matchedResultsTable" class="table hidden">
                <thead>
                    <tr>
                        <th>No.</th>
                        <th>Analysis</th>
                    </tr>
                </thead>
                <tbody id="matchedResultsRows">
                    <!-- Matched results will be inserted here-->
                </tbody>
            </table>
        </div>

        <!-- New Category Table -->
        <div class="long-number">
        <div class="table-responsive">
            <table id="newCategoryTable" class="table hidden">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="newCategoryRows">
                    <!-- New category values will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>
<!-- Age Range Filter Table -->
<h5 class="text-center">Age Range Analysis 年龄范围分析</h5>
<div class="table-responsive pb-5">
    <table id="ageRangeFilterTable" class="table hidden">
        <thead>
            <tr>
                <th>Age Range</th>
                <th>Numbers</th>
            </tr>
        </thead>
        <tbody id="ageRangeFilterRows">
            <!-- Filtered category values will be inserted here -->
        </tbody>
    </table>
</div>

        <!-- Lunar Converter -->
        <div class="convert-lunar">
            <h5 class="text-center">Lunar Analysis 农历分析</h5>
            <div class="table-responsive pb-5">
                <table id="lunarConverterTable" class="table hidden">
                    <thead>
                        <tr>
                            <th>Minus 负 11</th>
                            <th>Chinese Lunar Date 农历</th>
                        </tr>
                    </thead>
                    <tbody id="lunarConverterRows">
                        <!-- Lunar conversion results will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>


        <!-- Lunar Numbers -->
        <h5 class="text-center">Lunar Numbers 农历数字</h5>
        <div class="table-responsive pb-5">
            <table id="lunarNumbersTable" class="table hidden">
                <thead>
                    <tr>
                        <th>L1</th>
                        <th>L2</th>
                        <th>L3</th>
                        <th>L4</th>
                        <th>L5</th>
                        <th>L6</th>
                    </tr>
                </thead>
                <tbody id="lunarNumbersRows">
                    <!-- Lunar numbers will be inserted here -->
                </tbody>
            </table>
        </div>

        <!-- Lunar Note Section -->
<h5 class="text-center">Lunar Note 农历注意事项</h5>
<div class="table-responsive pb-5">
    <table id="lunarNoteTable" class="table hidden">
        <thead>
            <tr>
                <th>No.</th>
                <th>Take Note 注意</th>
            </tr>
        </thead>
        <tbody id="lunarNoteRows">
            <!-- Lunar notes will be inserted here -->
        </tbody>
    </table>
</div>


        <!-- Lunar Age Range -->
        <h5 class="text-center">Lunar Age Range Analysis 农历年龄范围分析</h5>
        <div class="table-responsive pb-5">
            <table id="lunarAgeRangeTable" class="table hidden">
                <thead>
                    <tr>
                        <th>Age Range</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody id="lunarAgeRangeRows">
                    <!-- Lunar age range values will be inserted here -->
                </tbody>
            </table>
        </div>

    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/lunar-javascript/1.6.12/lunar.js"
        integrity="sha512-fS2RQklOT+Mgu5s5XdyhA0XZ1Uyyd75eMGTGX/RkadeeYoug7WYHOYiIvSGHeUx0+Bb35DwwqpNdIuZFohPv0A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="./js/iching.js"></script>
    <script src="./js/takeNote.js"></script>
    <script src="./js/fancy-box-lookup.js"></script>
    <script src="./js/fancybox.min.js"></script>
    <script>
        document.getElementById('icForm').addEventListener('submit', function (event) {
    event.preventDefault();

    const icNumber = document.getElementById('icNumber').value;
    const datePart = icNumber.slice(0, 6);
    const rrPart = icNumber.slice(6, 8);
    const nnPart = icNumber.slice(8, 12);
    const yearPart = datePart.slice(0, 2);
    const monthPart = datePart.slice(2, 4);
    const dayPart = datePart.slice(4, 6);
    const currentYear = new Date().getFullYear();
    let birthYear = parseInt(yearPart);

    // Adjust year to 4 digits
    if (birthYear <= parseInt(currentYear.toString().slice(-2))) {
        birthYear += 2000;
    } else {
        birthYear += 1900;
    }

    // Check if the year is within the valid range
    if (birthYear < 1950 || birthYear > 2024) {
        alert("Year of birth must be between 1950 and 2024.");
        return;
    }

    const age = currentYear - birthYear;

    const formattedData = {
        Y1: datePart.charAt(0),
        Y2: datePart.charAt(1),
        M1: datePart.charAt(2),
        M2: datePart.charAt(3),
        D1: datePart.charAt(4),
        D2: datePart.charAt(5),
        R1: rrPart.charAt(0),
        R2: rrPart.charAt(1),
        N1: nnPart.charAt(0),
        N2: nnPart.charAt(1),
        N3: nnPart.charAt(2),
        N4: nnPart.charAt(3)
    };

    const formattedRow = document.getElementById('formattedRow');
    formattedRow.innerHTML = Object.entries(formattedData).map(([key, value]) => {
        const separatorClass = ['Y2', 'M2', 'D2', 'R2', 'N2'].includes(key) ? 'class="separator"' : '';
        return `<td ${separatorClass}>${value}</td>`;
    }).join('');

    const ageRow = document.getElementById('ageRow');
    ageRow.innerHTML = `
        <td>${currentYear}</td>
        <td>${birthYear}</td>
        <td>${age}</td>
    `;

    document.getElementById('formattedIC').classList.remove('hidden');
    document.getElementById('ageTable').classList.remove('hidden');

    // Calculate and display values for age categories
    const categoryRows = document.getElementById('categoryRows');
    categoryRows.innerHTML = ''; // Clear previous entries

    if (age >= 13 && age <= 22) {
        categoryRows.innerHTML += `<tr><td>Age 13-22</td><td>${formattedData.Y2},${formattedData.M1},${formattedData.M2}</td></tr>`;
    }
    if (age >= 23 && age <= 32) {
        categoryRows.innerHTML += `<tr><td>Age 23-32</td><td>${formattedData.M2},${formattedData.D1},${formattedData.D2}</td></tr>`;
    }
    if (age >= 33 && age <= 42) {
        categoryRows.innerHTML += `<tr><td>Age 33-42</td><td>${formattedData.D2},${formattedData.R1},${formattedData.R2}</td></tr>`;
    }
    if (age >= 43 && age <= 52) {
        categoryRows.innerHTML += `<tr><td>Age 43-52</td><td>${formattedData.R2},${formattedData.N1},${formattedData.N2}</td></tr>`;
    }
    if (age >= 53 && age <= 62) {
        categoryRows.innerHTML += `<tr><td>Age 53-62</td><td>${formattedData.N2},${formattedData.N3},${formattedData.N4}</td></tr>`;
    }
    if (age >= 63 && age <= 72) {
        categoryRows.innerHTML += `<tr><td>Age 63-72</td><td>${formattedData.N4},${formattedData.Y1},${formattedData.Y2}</td></tr>`;
    }

    document.getElementById('categoryTable').classList.remove('hidden');

    // Display category values in the new section
    const newCategoryRows = document.getElementById('newCategoryRows');
    newCategoryRows.innerHTML = ''; // Clear previous entries
    newCategoryRows.innerHTML += `<tr><td>Age 13-22</td><td>${formattedData.Y1},${formattedData.Y2},${formattedData.M1},${formattedData.M2}</td></tr>`;
    newCategoryRows.innerHTML += `<tr><td>Age 23-32</td><td>${formattedData.Y1},${formattedData.Y2},${formattedData.M1},${formattedData.M2},${formattedData.D1},${formattedData.D2}</td></tr>`;
    newCategoryRows.innerHTML += `<tr><td>Age 33-42</td><td>${formattedData.Y1},${formattedData.Y2},${formattedData.M1},${formattedData.M2},${formattedData.D1},${formattedData.D2},${formattedData.R1},${formattedData.R2}</td></tr>`;
    newCategoryRows.innerHTML += `<tr><td>Age 43-52</td><td>${formattedData.Y1},${formattedData.Y2},${formattedData.M1},${formattedData.M2},${formattedData.D1},${formattedData.D2},${formattedData.R1},${formattedData.R2},${formattedData.N1},${formattedData.N2}</td></tr>`;
    newCategoryRows.innerHTML += `<tr><td>Age 53-62</td><td>${formattedData.Y1},${formattedData.Y2},${formattedData.M1},${formattedData.M2},${formattedData.D1},${formattedData.D2},${formattedData.R1},${formattedData.R2},${formattedData.N1},${formattedData.N2},${formattedData.N3},${formattedData.N4}</td></tr>`;
    newCategoryRows.innerHTML += `<tr><td>Age 63-72</td><td>${formattedData.Y1},${formattedData.Y2},${formattedData.M1},${formattedData.M2},${formattedData.D1},${formattedData.D2},${formattedData.R1},${formattedData.R2},${formattedData.N1},${formattedData.N2},${formattedData.N3},${formattedData.N4},${formattedData.Y1},${formattedData.Y2}</td></tr>`;

    document.getElementById('newCategoryTable').classList.remove('hidden');

    // Call the lookup function after category values are displayed
    lookupConsecutiveNumbers();

    document.getElementById('consecutiveNumberTable').classList.remove('hidden');

    // Filter age range categories and display results
    filterAgeRangeCategories();

    // Call the lookup function after user input for take note section
    lookupConsecNumbers();

    // Add the lookupLunarNotes function call at the end
    lookupLunarNotes();
    
});

function filterAgeRangeCategories() {
    const newCategoryRows = document.getElementById('newCategoryRows');
    const ageRangeFilterRows = document.getElementById('ageRangeFilterRows');
    ageRangeFilterRows.innerHTML = ''; // Clear previous entries

    // Iterate over each row in the new category table
    newCategoryRows.querySelectorAll('tr').forEach(row => {
        const ageRange = row.children[0].innerText;
        let values = row.children[1].innerText.split(',');

        // Filter out 0 and 5
        values = values.filter(value => value !== '0' && value !== '5');

        // Remove consecutive double numbers
        values = values.filter((value, index, self) => {
            return self[index] !== self[index + 1];
        });

        // Display only the last 3 digit numbers
        const filteredValues = values.slice(-3);

        ageRangeFilterRows.innerHTML += `<tr><td>${ageRange}</td><td>${filteredValues.join(',')}</td></tr>`;
    });

    document.getElementById('ageRangeFilterTable').classList.remove('hidden');
}


    </script>
</body>

</html>